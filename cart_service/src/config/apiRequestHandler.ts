import axios from "axios";

const api = axios.create({
  baseURL: process.env.SERVICE_DISCOVERY_URL || "192.168.106.128:5000",
  timeout: 1000 * 20,
});

const errorHandler = (error: any) => {
  // console.error(`error generated by axios intercepter`);
  // if (error.response) {
  //   console.error(`status: ${error.response.status}\n`, error.response.data);
  // } else {
  //   console.error(error);
  // }
  return Promise.reject(error);
};

api.interceptors.response.use(undefined, (error) => {
  return errorHandler(error);
});

type ApiResult = {
  data?: any;
  status?: number;
};

const apiRequestHandler = async (
  options: any
): Promise<[ApiResult, Error | null]> => {
  try {
    const { data, status } = await api.request(options);
    return [{ data, status }, null];
  } catch (error) {
    if (error.response) {
      return [
        {
          status: error.response.status,
          data: error.response.data,
        },
        null,
      ];
    } else {
      return [{}, error];
    }
  }
};

export default apiRequestHandler;
